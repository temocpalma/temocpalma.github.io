<!DOCTYPE html>
<html>
  <head>
    <title>El Blog de Temoc</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2020-03-28T00:24:01 CST">
<title>Creación de Pruebas Unitarias con Spock y Groovy :: El Blog de Temoc</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/hybrid.css" rel="stylesheet">
<link href="/css/featherlight.min.css" rel="stylesheet">
<link href="/css/auto-complete.css" rel="stylesheet">
<link href="/theme-original/style.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<meta name="description" content="">


    
  </head>
  <body data-url="/posts/development/using-spock-with-unit-test-on-groovy/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <p>EL BLOG DE TEMOC</p>

  


    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="/js/lunr.min.js"></script>
		<script type="text/javascript" src="/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "https:\/\/temocpalma.github.io\/";
        
		</script>
		<script type="text/javascript" src="/js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/" class="dd-item">
            <a href="/"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="https://temocpalma.github.io/posts/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/posts/">Posts</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="https://temocpalma.github.io/posts/development/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/posts/development/">Programación</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="https://temocpalma.github.io/posts/development/using-spock-with-unit-test-on-groovy/" class="dd-item active">
        <div>
          <a href="/posts/development/using-spock-with-unit-test-on-groovy/">
            <i class='fa fa-anchor'></i> Creación de Pruebas Unitarias con Spock y Groovy
          </a>
        </div>
    </li>
      <li data-nav-id="https://temocpalma.github.io/posts/development/basic-tools-for-development/" class="dd-item">
        <div>
          <a href="/posts/development/basic-tools-for-development/">
            <i class='fa fa-anchor'></i> Herramientas básicas para desarrollo de software
          </a>
        </div>
    </li>
      <li data-nav-id="https://temocpalma.github.io/posts/development/react_intro/" class="dd-item">
        <div>
          <a href="/posts/development/react_intro/">
            <i class='fa fa-anchor'></i> Introducción a React JS
          </a>
        </div>
    </li>
        </ul>
    </li>
      <li data-nav-id="https://temocpalma.github.io/posts/creating-my-blog-with-hugo/" class="dd-item">
        <div>
          <a href="/posts/creating-my-blog-with-hugo/">
            <i class='fa fa-anchor'></i> Creación del blog
          </a>
        </div>
    </li>
    <li data-nav-id="https://temocpalma.github.io/posts/tricks/" class="dd-item haschildren
        ">
      <div>
      <a href="/posts/tricks/">Trucos</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="https://temocpalma.github.io/posts/tricks/clean-install-high-sierra-mac-os/" class="dd-item">
        <div>
          <a href="/posts/tricks/clean-install-high-sierra-mac-os/">
            <i class='fa fa-anchor'></i> Instalación limpia de MacOs High Sierra
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://temocpalma.github.io/posts/history/" class="dd-item
        ">
      <div>
      <a href="/posts/history/">Historia</a>
      </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://temocpalma.github.io/hobbies/" class="dd-item haschildren
        ">
      <div>
      <a href="/hobbies/">Hobbies</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="https://temocpalma.github.io/hobbies/collections/" class="dd-item haschildren
        ">
      <div>
      <a href="/hobbies/collections/">Colecciones</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="https://temocpalma.github.io/hobbies/collections/national_bills/" class="dd-item">
        <div>
          <a href="/hobbies/collections/national_bills/">
            <i class='fa fa-anchor'></i> Billetes Nacionales
          </a>
        </div>
    </li>
      <li data-nav-id="https://temocpalma.github.io/hobbies/collections/toys/" class="dd-item">
        <div>
          <a href="/hobbies/collections/toys/">
            <i class='fa fa-anchor'></i> Juguetes
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://temocpalma.github.io/hobbies/travels/" class="dd-item haschildren
        ">
      <div>
      <a href="/hobbies/travels/">Viajes</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="https://temocpalma.github.io/hobbies/travels/oaxaca/" class="dd-item">
        <div>
          <a href="/hobbies/travels/oaxaca/">
            <i class='fa fa-anchor'></i> Oaxaca
          </a>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://temocpalma.github.io/books/" class="dd-item haschildren
        ">
      <div>
      <a href="/books/">Books</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="https://temocpalma.github.io/books/books_science/" class="dd-item">
        <div>
          <a href="/books/books_science/">
            Ciencia
          </a>
        </div>
    </li>
      <li data-nav-id="https://temocpalma.github.io/books/books_scifi/" class="dd-item">
        <div>
          <a href="/books/books_scifi/">
            Ciencia Ficción
          </a>
        </div>
    </li>
      <li data-nav-id="https://temocpalma.github.io/books/books_history/" class="dd-item">
        <div>
          <a href="/books/books_history/">
            Historia
          </a>
        </div>
    </li>
      <li data-nav-id="https://temocpalma.github.io/books/books_novels/" class="dd-item">
        <div>
          <a href="/books/books_novels/">
            Novelas
          </a>
        </div>
    </li>
      <li data-nav-id="https://temocpalma.github.io/books/books_ti/" class="dd-item">
        <div>
          <a href="/books/books_ti/">
            TI
          </a>
        </div>
    </li>
        </ul>
    </li>



        <section id="shortcuts">
                <li class="" role=""><a href="/about" target="_blank" rel="noopener"><i class='fa fa-user-circle'></i> Quién soy...</a></li>
                <li class="" role=""><a href="/socialnet" target="_blank" rel="noopener"><i class='fa fa-address-book'></i> Sígueme</a></li>
        </section>

    <hr />
    <li></li>
    
    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        










 <a href='https://temocpalma.github.io/'></a> > <a href='https://temocpalma.github.io/posts/'>Posts</a> > <a href='https://temocpalma.github.io/posts/development/'>Programación</a> > Creación de Pruebas Unitarias con Spock y Groovy

 

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introducción">Introducción</a></li>
    <li><a href="#definiciones">Definiciones</a></li>
    <li><a href="#ejemplo">Ejemplo</a>
      <ul>
        <li><a href="#agregar-la-dependencia-a-la-aplicación">Agregar la dependencia a la aplicación</a></li>
        <li><a href="#creando-las-pruebas">Creando las pruebas</a></li>
        <li><a href="#creando-las-pruebas-para-solucionar-el-problema">Creando las pruebas para solucionar el problema</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Creación de Pruebas Unitarias con Spock y Groovy</h1>
  



    
    
    
    <p><em>07-09-2017</em></p>
<h2 id="introducción">Introducción</h2>
<p>La creación de pruebas automatizadas de software son una tarea aún poco apreciada en el desarrollo de software, ya que muchos lo consideran un trabajo &ldquo;extra&rdquo; no necesario de realizar, principalmente cuando el programador tiene ya dominio en la solución de problemas en el lenguaje en el que se desenvuelva; ya que muchas veces se escribe más código en las pruebas que en el componente que se está probando.</p>
<p>Sin embargo, esa forma de pensamiento, es equivocada. Las pruebas automatizadas son una herramienta que no sólo nos ayuda a garantizar en gran medida que el componente de software desarrollado funcione bien (que hace lo que tiene que hacer) sino que además nos ayuda a mejorar las buenas prácticas a la hora de programar (escribimos mejor código usando pruebas).</p>
<p>Además, ayudan a mantener la estabilidad de la aplicación completa, al poder ejecutarse de una forma muy rápida, cientos o hasta miles de pruebas de los componentes involucrados en ella, de forma que cuando algún programador cambia o modifica lógica de esos componentes tendrá que ajustar o complementar los tests relacionados, de lo contrario, las pruebas fallarán.</p>
<h2 id="definiciones">Definiciones</h2>
<ul>
<li>
<p><strong>Pruebas Unitarias:</strong> Son pruebas que se aplican a un componente muy específico de la aplicación (un método). Son las más básicas de las pruebas, y en ella no se consideran afectaciones a la base de datos o archivos de configuración de la aplicación, por lo que esos elementos se &ldquo;emulan&rdquo; para fines de la prueba.</p>
</li>
<li>
<p><strong><a href="http://spockframework.org/">SpockFramework</a>:</strong> Es un framework que nos ayuda a crear pruebas usando un notación muy intuitiva (<em>especificaciones</em>), para aplicaciones Java y Groovy.</p>
</li>
<li>
<p><strong><a href="http://groovy-lang.org/">Groovy</a>:</strong> Es un lenguaje dinámico para plataforma de Java.</p>
</li>
</ul>
<h2 id="ejemplo">Ejemplo</h2>
<p>Para mostrar básicamente cómo crear pruebas unitarias con Spock, usaré una pequeña aplicación Groovy con <a href="https://gradle.org/">Gradle</a>. La aplicación consiste en clasificar a una persona en un grupo dada su edad de la siguiente manera:</p>
<ul>
<li>0 - 11 años, Infantes</li>
<li>12 - 18 años, Adolescentes</li>
<li>19 - 30 años, Jóvenes</li>
<li>30 - 60 años, Adultos</li>
<li>61 o más, Adultos Mayores</li>
</ul>
<h3 id="agregar-la-dependencia-a-la-aplicación">Agregar la dependencia a la aplicación</h3>
<p>Lo primero es agregar la dependencia necesaria a la aplicación para poder utilizar el framework (en el archivo <em>build.gradle</em>):</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">testCompile</span> <span class="s2">&#34;org.spockframework:spock-core:1.1-groovy-2.4&#34;</span>
</code></pre></div><h3 id="creando-las-pruebas">Creando las pruebas</h3>
<p>Dentro de la carpeta de pruebas de la aplicación (<em>src/test/groovy/com/exampletests/org</em>) creamos la clase de pruebas correspondiente, con un test de ejemplo:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy">
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">exampletests</span><span class="o">.</span><span class="na">edu</span>

<span class="kn">import</span> <span class="nn">spock.lang.*</span>

<span class="kd">class</span> <span class="nc">ClasificationServiceSpec</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>
  
  <span class="kt">void</span> <span class="s2">&#34;Example test&#34;</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="nl">setup:</span>
      <span class="kt">int</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span>
      <span class="kt">int</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span>
    <span class="nl">when:</span>
      <span class="kt">def</span> <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="nl">then:</span>
      <span class="n">result</span> <span class="o">=</span><span class="o">=</span> <span class="mi">1</span>
  <span class="o">}</span>

<span class="o">}</span>

</code></pre></div><p>Para ejecutar los test, en la consola de comandos, ubicados en la carpeta raíz del proyecto de la aplicación, tecleamos: <code>gradle test</code></p>
<p>La especificación (el test) en este ejemplo incluye 3 secciones:</p>
<p><strong>setup</strong>, para inicializar los valores necesarios para la prueba</p>
<p><strong>when</strong>, donde se indica el proceso que se quiere probar con los valores definidos en la sección anterior</p>
<p><strong>then</strong>, donde se definen los resultados esperados del proceso</p>
<p>Las secciones requeridas son <strong>when</strong> y <strong>then</strong></p>
<h3 id="creando-las-pruebas-para-solucionar-el-problema">Creando las pruebas para solucionar el problema</h3>
<p>Cambiemos la prueba anterior por la siguiente:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy">
  <span class="kt">void</span> <span class="s2">&#34;Should get CHILDREN category when the age is between 0 and 11 years old&#34;</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="nl">given:</span>
      <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="nl">when:</span>
      <span class="n">String</span> <span class="n">category</span> <span class="o">=</span> <span class="n">classificationService</span><span class="o">.</span><span class="na">getCategoryForAge</span><span class="o">(</span><span class="n">age</span><span class="o">)</span>
    <span class="nl">then:</span>
      <span class="n">category</span> <span class="o">=</span><span class="o">=</span> <span class="s2">&#34;CHILDREN&#34;</span>
  <span class="o">}</span>

</code></pre></div><p>Si se corren las pruebas con el comando <code>gradle test</code> arrojará un error, ya que el elemento <strong>classificationService</strong> no existe aún y la clase de pruebas no la tiene definida.</p>
<p>Vamos a crear la clase de servicio con el método que devolverá la categoría correspondiente según la edad que se indique. En la carpeta <strong>src/main/groovy/com/exampletests/edu</strong> tecleamos el siguiente código:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy">
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">exampletests</span><span class="o">.</span><span class="na">edu</span>

<span class="kd">class</span> <span class="nc">ClassificationService</span> <span class="o">{</span>
  
  <span class="n">String</span> <span class="nf">getCategoryForAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
    <span class="s2">&#34;CHILDREN&#34;</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div><p>Ahora en la clase de pruebas, agregamos una instancia de la clase de servicio:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"> 
<span class="kd">class</span> <span class="nc">ClasificationServiceSpec</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>
  
  <span class="n">ClassificationService</span> <span class="n">classificationService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassificationService</span><span class="o">(</span><span class="o">)</span>

  <span class="kt">void</span> <span class="s2">&#34;Should get CHILDREN category when the age is between 0 and 11 years old&#34;</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">.</span><span class="o">.</span><span class="o">.</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div><p>Ejecutemos las pruebas nuevamente con el comando <code>gradle test</code>, ahora no debería haber errores.</p>
<p>Bien, la prueba creada sólo cubre un sólo caso de todos los que el componente puede responder. Para incluir los otros casos, usaremos una tabla de datos.</p>
<p>En nuestra clase de pruebas, agreguemos la siguiente <em>especificación</em>:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy">  
  <span class="nd">@Unroll</span>
  <span class="kt">void</span> <span class="s2">&#34;Should get the category #theCategory when the age is #theAge&#34;</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="nl">given:</span>
      <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="n">theAge</span>
    <span class="nl">when:</span>
      <span class="n">String</span> <span class="n">category</span> <span class="o">=</span> <span class="n">classificationService</span><span class="o">.</span><span class="na">getCategoryForAge</span><span class="o">(</span><span class="n">age</span><span class="o">)</span>
    <span class="nl">then:</span>
      <span class="n">category</span> <span class="o">=</span><span class="o">=</span> <span class="n">theCategory</span>
    <span class="nl">where:</span>
      <span class="n">theAge</span>              <span class="o">|</span><span class="o">|</span>      <span class="n">theCategory</span>
        <span class="mi">5</span>                 <span class="o">|</span><span class="o">|</span>      <span class="s2">&#34;CHILDREN&#34;</span>
        <span class="mi">15</span>                <span class="o">|</span><span class="o">|</span>      <span class="s2">&#34;TEENAGERS&#34;</span>
        <span class="mi">25</span>                <span class="o">|</span><span class="o">|</span>      <span class="s2">&#34;YOUNGS&#34;</span>
        <span class="mi">35</span>                <span class="o">|</span><span class="o">|</span>      <span class="s2">&#34;ADULTS&#34;</span>
        <span class="mi">45</span>                <span class="o">|</span><span class="o">|</span>      <span class="s2">&#34;ADULTS&#34;</span>
        <span class="mi">65</span>                <span class="o">|</span><span class="o">|</span>      <span class="s2">&#34;OLDERS&#34;</span>
        <span class="o">-</span><span class="mi">1</span>                <span class="o">|</span><span class="o">|</span>      <span class="s2">&#34;UNDEFINED&#34;</span>
  <span class="o">}</span>

</code></pre></div><p>Al ejecutar los tests nuevamente, no debería haber errores.</p>
<p>Hagamos que uno de los registros de la tabla de datos falle. Cambiemos el valor esperado de la fila con la edad 35 a &ldquo;YOUNGS&rdquo;, y corramos las pruebas.</p>
<p>Ahora el resultado debería ser fallido, mostrando los resultados como se muestra en la figura siguiente:</p>
<p><!-- raw HTML omitted --></p>
<p>Podemos ver que en el resultado mostrado nos indica en el nombre del test los valores usados, que fueron los que fallaron. Además vemos que hay una referencia a un archivo html, generado por el framework, el cuál es un reporte bastante completo sobre las pruebas, si lo abrimos podemos ver la lista de las pruebas fallidas:</p>
<p><!-- raw HTML omitted --></p>
<p>Al darle clic al link del nombre del test fallido, nos da un reporte de la falla para este test en particular:</p>
<p><!-- raw HTML omitted --></p>
<p>Como se puede observar, la creación de pruebas unitarias usando Spock, es bastante sencillo. El framework nos da un reporte bastante útil para poder ir resolviendo las fallas de los componentes correspondientes.</p>

    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="/posts/development/" title="Programación"> <i class="fa fa-chevron-left"></i><label>Programación</label></a>
    <a class="nav nav-next" href="/posts/development/basic-tools-for-development/" title="Herramientas básicas para desarrollo de software" style="margin-right: 0px;"><label>Herramientas básicas para desarrollo de software</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="/js/clipboard.min.js"></script>
<script src="/js/featherlight.min.js"></script>
<script src="/js/html5shiv-printshiv.min.js"></script>

<script src="/js/modernizr.custom.71422.js"></script>
<script src="/js/docdock.js"></script>
<script src="/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>